{"version":3,"sources":["signalR.js"],"names":[],"mappings":"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","file":"signalR-compiled.js","sourcesContent":["ï»¿//# signalr-client\r\n//By: [Matthew Whited](mailto:matt@whited.us?subject=signalr-client)  (c) 2015\r\n// v0.0.16\r\n\r\n//modifications made to add support for https/wss By: Anthony DiPierro\r\n\r\n//TODO: Fix HTTPS Proxy \r\n// https://newspaint.wordpress.com/2012/11/05/node-js-http-and-https-proxy/\r\n/* ~Vincent Miceli */\r\n//TODO: consider changing binding/start order\r\n\r\nvar url = require('url'),\r\n    querystring = require('querystring'),\r\n    http = require('http'),\r\n    https = require('https'),\r\n    WebSocketClient = require('websocket').client; // https://github.com/Worlize/WebSocket-Node\r\n//barry code\r\nvar express = require('express');\r\nvar fs = require('fs');\r\n\r\n// This line is from the Node.js HTTPS documentation.\r\nvar options = {\r\n    key: fs.readFileSync('./certs/fairtrade.key'),\r\n    cert: fs.readFileSync('./certs/fairtrade.cer')\r\n};\r\n\r\n// Create a service (the app object is just a callback).\r\nvar app = express();\r\n\r\n// Create an HTTP service.\r\n//http.createServer(app).listen(80);\r\n// Create an HTTPS service identical to the HTTP service.\r\nhttps.createServer(options, app).listen(443);\r\n//end barry code\r\n\r\nvar states = {\r\n    connection: {\r\n        unbound: 0,\r\n        bound: 1,\r\n        connecting: 2,\r\n        connected: 3,\r\n        disconnecting: 4,\r\n        disconnected: 5,\r\n        connectFailed: 6,\r\n        errorOccured: 7,\r\n        retryingConnection: 8,\r\n        bindingError: 9,\r\n        retryingFailed: 10,\r\n    },\r\n    getConnection: function (code) {\r\n        for (value in states.connection) {\r\n            if (states.connection[value] == code)\r\n                return value;\r\n        }        ;\r\n        return undefined;\r\n    }\r\n};\r\n\r\nfunction toCleanHubNames(hubNames) {\r\n    var res = [], o = 0;\r\n\r\n    if (hubNames.length && hubNames.length > 0) {\r\n        for (var i = 0; i < hubNames.length; i++) {\r\n            var p = hubNames[i];\r\n            if (typeof p === \"string\") {\r\n                res[o++] = { name: p.toLowerCase() };\r\n            }\r\n        }\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\nfunction removeUndefinedProperties(obj) {\r\n    if (obj) {\r\n        for (var propName in obj) {\r\n            if (typeof obj[propName] == \"undefined\") {\r\n                delete obj[propName];\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction mergeFrom(target, source) {\r\n    target = target || {};\r\n\r\n    if (source) {\r\n        for (var propName in source) {\r\n            target[propName] = source[propName];\r\n        }\r\n    }\r\n    else {\r\n        target = {};\r\n    }\r\n}\r\n\r\nfunction negotiateProxies(baseUrl, hubNames, onSuccess, onError, _client) {\r\n\r\n    var cleanedHubs = toCleanHubNames(hubNames);\r\n    if (!cleanedHubs || cleanedHubs.length < 1) {\r\n        onError('you must define at least one hub name and they must be typeof string');\r\n        return;\r\n    }\r\n\r\n    var negotiateData = \"\";\r\n    var negotiateUrl = baseUrl + \"/negotiate?\" + querystring.stringify({\r\n            connectionData: JSON.stringify(cleanedHubs),\r\n            clientProtocol: 1.5\r\n        });\r\n    var negotiateUrlOptions = url.parse(negotiateUrl, true);\r\n\r\n    var negotiateFunction = function (res) {\r\n        res.on('data', function (chunk) {\r\n            negotiateData += chunk;\r\n        });\r\n        res.on('end', function (endRes) {\r\n            try {\r\n                if (res.statusCode == 200) {\r\n                    var negotiateObj = JSON.parse(negotiateData);\r\n                    negotiateObj.Hubs = cleanedHubs;\r\n                    onSuccess(negotiateObj);\r\n                } else if (res.statusCode == 401 || res.statusCode == 302) {\r\n                    if (_client.serviceHandlers.onUnauthorized) {\r\n                        _client.serviceHandlers.onUnauthorized(res);\r\n                    } else {\r\n                        console.log('negotiate::Unauthorized (' + res.statusCode + ')');\r\n                    }\r\n                } else {\r\n                    console.log('negotiate::unknown (' + res.statusCode + ')');\r\n                }\r\n            } catch (e) {\r\n                onError('Parse Error', e, negotiateData);\r\n            }\r\n        });\r\n        res.on('error', function (e) {\r\n            _client.connection.state = states.connection.bindingError;\r\n            if (_client.serviceHandlers.bindingError) {\r\n                _client.serviceHandlers.bindingError(e);\r\n            } else {\r\n                onError('HTTP Error', e);\r\n            }\r\n        });\r\n    };\r\n    var negotiateErrorFunction = function (e) {\r\n        _client.connection.state = states.connection.bindingError;\r\n        if (_client.serviceHandlers.bindingError) {\r\n            _client.serviceHandlers.bindingError(e);\r\n        } else {\r\n            onError('HTTP Negotiate Error', e);\r\n        }\r\n    };\r\n\r\n    if (negotiateUrlOptions.headers === undefined) {\r\n        negotiateUrlOptions.headers = {};\r\n    }\r\n    if (_client.headers) {\r\n        for (var propName in _client.headers) {\r\n            negotiateUrlOptions.headers[propName] = _client.headers[propName];\r\n        }\r\n    }\r\n\r\n    if (_client.proxy && _client.proxy.host && _client.proxy.port) {\r\n        negotiateUrlOptions.path = negotiateUrlOptions.protocol + '//' + negotiateUrlOptions.host + negotiateUrlOptions.path;\r\n        negotiateUrlOptions.headers.host = negotiateUrlOptions.host;\r\n        negotiateUrlOptions.host = _client.proxy.host;\r\n        negotiateUrlOptions.port = _client.proxy.port;\r\n    }\r\n\r\n    if (negotiateUrlOptions.protocol === 'http:') {\r\n        var negotiateResult = http.get(negotiateUrlOptions, negotiateFunction).on('error', negotiateErrorFunction);\r\n    } else if (negotiateUrlOptions.protocol === 'wss:') {\r\n        negotiateUrlOptions.protocol = 'https:';\r\n        var negotiateResult = https.get(negotiateUrlOptions, negotiateFunction).on('error', negotiateErrorFunction);\r\n\r\n    } else {\r\n        onError('Protocol Error', undefined, negotiateUrlOptions);\r\n    }\r\n}\r\n\r\nfunction getBindings(baseUrl, hubNames, onSuccess, onError, _client) {\r\n    negotiateProxies(baseUrl, hubNames, function (negotiatedOptions) {\r\n\r\n        if (!negotiatedOptions.TryWebSockets) {\r\n            onError('This client only supports websockets', undefined, negotiatedOptions);\r\n            return;\r\n        }\r\n\r\n        //negotiatedOptions.Url\t                    \"/signalr\"\t        String\r\n        //negotiatedOptions.ProtocolVersion\t        \"1.2\"\t            String\r\n        //negotiatedOptions.TryWebSockets\t        true\t            Boolean\r\n        //negotiatedOptions.ConnectionToken\t        \"...\"\t            String\r\n        //negotiatedOptions.ConnectionId\t        \"...\"\t            String\r\n        //negotiatedOptions.Hubs                    [{name: \"...\"}]     Array\r\n        //negotiatedOptions.KeepAliveTimeout\t    20\t                Number\r\n        //negotiatedOptions.DisconnectTimeout\t    30\t                Number\r\n        //negotiatedOptions.TransportConnectTimeout\t5\t                Number\r\n\r\n        onSuccess({\r\n            url: baseUrl,\r\n            connection: {\r\n                token: negotiatedOptions.ConnectionToken,\r\n                id: negotiatedOptions.ConnectionId\r\n            },\r\n            timeouts: {\r\n                keepAlive: negotiatedOptions.KeepAliveTimeout,\r\n                disconnect: negotiatedOptions.DisconnectTimeout,\r\n                connect: negotiatedOptions.TransportConnectTimeout\r\n            },\r\n            hubs: negotiatedOptions.Hubs\r\n        });\r\n\r\n    }, onError, _client);\r\n}\r\n\r\nfunction getConnectQueryString(_client) {\r\n    var connectData = \"\";\r\n    var qs = {\r\n        clientProtocol: 1.5,\r\n        transport: \"webSockets\",\r\n        connectionToken: _client.connection.token,\r\n        connectionData: JSON.stringify(_client.hubData),\r\n        tid: 10\r\n    };\r\n\r\n    if (_client.queryString) {\r\n        for (var propName in _client.queryString) {\r\n            qs[propName] = _client.queryString[propName];\r\n        }\r\n    }\r\n\r\n    var connectQueryString = _client.url + \"/connect?\" + querystring.stringify(qs);\r\n    return connectQueryString;\r\n}\r\n\r\nfunction getAbortQueryString(_client) {\r\n    var qs = {\r\n        clientProtocol: 1.5,\r\n        transport: \"serverSentEvents\",\r\n        connectionData: JSON.stringify(_client.hubData),\r\n        connectionToken: _client.connection.token\r\n\r\n    };\r\n\r\n    if (_client.queryString) {\r\n        for (var propName in _client.queryString) {\r\n            qs[propName] = _client.queryString[propName];\r\n        }\r\n    }\r\n\r\n    var abortQueryString = _client.url + \"/abort?\" + querystring.stringify(qs);\r\n\r\n    return abortQueryString;\r\n\r\n}\r\n\r\nfunction getStartQueryString(_client) {\r\n    var qs = {\r\n        clientProtocol: 1.5,\r\n        transport: \"webSockets\",\r\n        connectionData: JSON.stringify(_client.hubData),\r\n        connectionToken: _client.connection.token\r\n    };\r\n\r\n    if (_client.queryString) {\r\n        for (var propName in _client.queryString) {\r\n            qs[propName] = _client.queryString[propName];\r\n        }\r\n    }\r\n\r\n    var startQueryString = _client.url + \"/start?\" + querystring.stringify(qs);\r\n\r\n    return startQueryString;\r\n}\r\n\r\n\r\nfunction getArgValues(params) {\r\n    var res = [];\r\n\r\n    if (params.length && params.length > 1) {\r\n        for (var i = 1; i < params.length; i++) {\r\n            var p = params[i];\r\n            if (typeof p === \"function\" || typeof p === \"undefined\") {\r\n                p = null;\r\n            }\r\n            res[i - 1] = p;\r\n        }\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\nfunction handlerErrors(errorMessage, e, errorData) {\r\n    console.log(\"Error Message: \", errorMessage);\r\n    console.log(\"Exception: \", e);\r\n    console.log(\"Error Data: \", errorData);\r\n\r\n    //throw errorMessage;\r\n}\r\n\r\nfunction buildPayload(hubName, methodName, args, messageId) {\r\n    var data = {\r\n        H: hubName,\r\n        M: methodName,\r\n        A: args,\r\n        I: messageId\r\n    };\r\n    var payload = JSON.stringify(data);\r\n    return payload;\r\n};\r\n\r\nfunction clientInterface(baseUrl, hubs, reconnectTimeout, doNotStart) {\r\n    var client = this;\r\n    var _client = {\r\n        proxy: {},\r\n        headers: {},\r\n        queryString: {},\r\n        pub: client,\r\n        url: baseUrl,\r\n        connection: {\r\n            state: states.connection.unbound,\r\n            token: null,\r\n            id: null\r\n        },\r\n        timeouts: {\r\n            keepAlive: 0,\r\n            disconnect: 0,\r\n            connect: 0\r\n        },\r\n        hubs: [],\r\n        hubData: [],\r\n        handlers: {},\r\n        serviceHandlers: {\r\n            bound: undefined,           // void function(){}\r\n            connectFailed: undefined,   // void function(error){}\r\n            connected: undefined,       // void function(connection){}\r\n            connectionLost: undefined,   // void function(error){}\r\n            disconnected: undefined,    // void function(){}\r\n            onerror: undefined,         // void function(error){}\r\n            messageReceived: undefined, // bool function(message){ return true /* if handled */}\r\n            bindingError: undefined,    // function(error) {} \r\n            onUnauthorized: undefined,  // function(res) {} \r\n            reconnected: undefined,     // void function(connection){}\r\n            reconnecting: undefined     // function(retry) { return false; } */\r\n        },\r\n\r\n        // https://github.com/Worlize/WebSocket-Node\r\n        websocket: {\r\n            client: new WebSocketClient(),\r\n            connection: null,\r\n            messageid: 0,\r\n            reconnectTimeout: reconnectTimeout || 10,\r\n            reconnectCount: 0\r\n        }\r\n    };\r\n\r\n    client.__defineGetter__('url', function () { return _client.url; });\r\n    client.__defineGetter__('state', function () {\r\n        var result = {\r\n            code: _client.connection.state,\r\n            desc: states.getConnection(_client.connection.state)\r\n        };\r\n        return result;\r\n    });\r\n\r\n    client.__defineGetter__('handlers', function () { return _client.handlers; });\r\n    client.__defineSetter__('handlers', function (val) { mergeFrom(_client.handlers, val); });\r\n\r\n    client.__defineGetter__('serviceHandlers', function () { return _client.serviceHandlers; });\r\n    client.__defineSetter__('serviceHandlers', function (val) { mergeFrom(_client.serviceHandlers, val); });\r\n\r\n    client.__defineGetter__('hubs', function () {\r\n        var ret = [], x = 0;\r\n        for (h in _client.hubs) {\r\n            ret[x++] = h;\r\n        }\r\n        return ret;\r\n    });\r\n    client.__defineGetter__('lastMessageId', function () { return _client.websocket.messageid; });\r\n\r\n    client.__defineGetter__('headers', function () {\r\n        removeUndefinedProperties(_client.headers);\r\n        return _client.headers;\r\n    });\r\n    client.__defineSetter__('headers', function (val) { mergeFrom(_client.headers, val); });\r\n\r\n    client.__defineGetter__('proxy', function () { return _client.proxy; });\r\n    client.__defineSetter__('proxy', function (val) { mergeFrom(_client.proxy, val); });\r\n\r\n    client.__defineGetter__('queryString', function () {\r\n        removeUndefinedProperties(_client.queryString);\r\n        return _client.queryString;\r\n    });\r\n    client.__defineSetter__('queryString', function (val) { mergeFrom(_client.queryString, val); });\r\n\r\n    client.hub = function (hubName) {\r\n        _client.start(false);\r\n        return _client.hubs[hubName.toLowerCase()];\r\n    };\r\n    client.on = function (hubName, methodName, callback) {\r\n        var handler = _client.handlers[hubName.toLowerCase()];\r\n        if (!handler) {\r\n            handler = _client.handlers[hubName.toLowerCase()] = {};\r\n        }\r\n        var method = handler[methodName.toLowerCase()] = callback;\r\n    };\r\n    client.end = function () {\r\n        if ((_client.connection.state == states.connection.connecting\r\n            || _client.connection.state == states.connection.connected)\r\n            && _client.websocket.connection) {\r\n            _client.connection.state = states.connection.disconnecting;\r\n            var connection = _client.websocket.connection;\r\n            _client.websocket.connection = undefined;\r\n            connection.close();\r\n        }\r\n    };\r\n    client.invoke = function (hubName, methodName) {\r\n        var hub = client.hub(hubName);\r\n        if (!hub)\r\n            return;\r\n        var args = getArgValues(arguments);\r\n        return hub.invoke.apply(hub, args);\r\n    };\r\n\r\n    var callTimeout = 30000;\r\n    var callCallbacks = {};\r\n\r\n    client.__defineGetter__('callTimeout', function () { return callTimeout; });\r\n    client.__defineSetter__('callTimeout', function (val) { callTimeout = val; });\r\n\r\n    client.call = function (hubName, methodName) {\r\n        var nohub = typeof client.invoke.apply(client, arguments) === 'undefined';\r\n        return {\r\n            done: function (cb, timeout) { // cb(err, result)\r\n                if (nohub) {\r\n                    cb('No Hub');\r\n                    return;\r\n                }\r\n                var messageId = client.lastMessageId;\r\n                var timeoutId = setTimeout(\r\n                    function () {\r\n                        delete callCallbacks[messageId];\r\n                        cb('Timeout');\r\n                    },\r\n                    timeout || callTimeout\r\n                );\r\n                callCallbacks[messageId] = function (err, result) {\r\n                    clearTimeout(timeoutId);\r\n                    delete callCallbacks[messageId];\r\n                    cb(err, result);\r\n                };\r\n            }\r\n        };\r\n    };\r\n    function handleCallResult(messageId, err, result) {\r\n        var cb = callCallbacks[messageId];\r\n        if (cb) cb(err, result);\r\n    }\r\n\r\n    client.start = function () {\r\n        _client.getBinding();\r\n    };\r\n\r\n    _client.invoke = function (_hub, methodName, args) {\r\n        _client.start(false);\r\n\r\n        var payload = buildPayload(_hub.data.name, methodName, args, ++_client.websocket.messageid);\r\n        //try to send message to signalR host\r\n        sendPayload(payload);\r\n        return payload;\r\n    };\r\n\r\n    function sendPayload(payload) {\r\n        if (_client.websocket.connection) {\r\n            _client.websocket.connection.send(payload);\r\n        } else {\r\n            setImmediate(sendPayload, payload);\r\n        }\r\n    }\r\n    function scheduleReconnection(isInitalRetry) {\r\n        //Ensure state is still reconnecting\r\n        if (_client.connection.state == states.connection.retryingConnection) {\r\n            if (isInitalRetry) {\r\n                _client.websocket.reconnectCount = 0;\r\n            } else {\r\n                _client.websocket.reconnectCount++;\r\n            }\r\n            var cancelRetry = false;\r\n            if (_client.serviceHandlers.reconnecting) {\r\n                var retry = { inital: isInitalRetry, count: _client.websocket.reconnectCount };\r\n                cancelRetry = _client.serviceHandlers.reconnecting.apply(client, [retry]);\r\n            }\r\n            if (!cancelRetry) {\r\n                setTimeout(function () {\r\n                    var connectQueryString = getConnectQueryString(_client);\r\n                    _client.websocket.client.connect(connectQueryString, undefined, undefined, _client.headers);\r\n                }, 1000 * _client.websocket.reconnectTimeout);\r\n                return true;\r\n            }\r\n            else {\r\n                _client.connection.state = states.connection.retryingFailed;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function abort() {\r\n\r\n        if (_client.connection.state === states.connection.disconnected || _client.connection.state === states.connection.disconnecting) {\r\n\r\n            var abortQueryString = getAbortQueryString(_client);\r\n\r\n            var abortUrlOptions = url.parse(abortQueryString, true);\r\n            var requestObject = undefined;\r\n\r\n\r\n            if (abortUrlOptions.protocol === 'http:') {\r\n                requestObject = http;\r\n            } else if (abortUrlOptions.protocol === 'wss:') {\r\n                abortUrlOptions.protocol = 'https:';\r\n                requestObject = https;\r\n            } else {\r\n                handlerErrors('Protocol Error', undefined, abortUrlOptions);\r\n            }\r\n\r\n            abortUrlOptions = {\r\n                hostname: abortUrlOptions.hostname,\r\n                port: abortUrlOptions.port,\r\n                method: 'POST',\r\n                path: abortUrlOptions.path\r\n            };\r\n\r\n            var req = requestObject.request(abortUrlOptions,\r\n                function (res) {\r\n\r\n                    //console.log('STATUS: ' + res.statusCode);\r\n                    //console.log('HEADERS: ' + JSON.stringify(res.headers));\r\n\r\n                    res.on('data', function (chunk) {\r\n                        //str += chunk;\r\n                    });\r\n\r\n                    res.on('end', function () {\r\n                        console.log('Connection aborted');\r\n\r\n                    });\r\n\r\n                });\r\n\r\n            req.on('error', function (e) {\r\n                handlerErrors('Can\\'t abort connection', e, abortUrlOptions);\r\n            });\r\n\r\n            req.end();\r\n        }\r\n\r\n    };\r\n\r\n    function startCommunication(onSuccess, onError) {\r\n\r\n        var startUrl = getStartQueryString(_client);\r\n\r\n        var startUrlOptions = url.parse(startUrl, true);\r\n\r\n        var startData = \"\";\r\n        var startFunction = function (res) {\r\n            res.on('data', function (chunk) {\r\n                startData += chunk;\r\n            });\r\n            res.on('end', function (endRes) {\r\n                try {\r\n                    if (res.statusCode == 200) {\r\n                        var startObj = JSON.parse(startData);\r\n                        onSuccess(startObj);\r\n                    } else if (res.statusCode == 401 || res.statusCode == 302) {\r\n                        if (_client.serviceHandlers.onUnauthorized) {\r\n                            _client.serviceHandlers.onUnauthorized(res);\r\n                        } else {\r\n                            console.log('start::Unauthorized (' + res.statusCode + ')');\r\n                        }\r\n                    } else {\r\n                        console.log('start::unknown (' + res.statusCode + ')');\r\n                    }\r\n                } catch (e) {\r\n                    onError('Parse Error', e, startData);\r\n                }\r\n            });\r\n            res.on('error', function (e) {\r\n                _client.connection.state = states.connection.bindingError;\r\n                if (_client.serviceHandlers.bindingError) {\r\n                    _client.serviceHandlers.bindingError(e);\r\n                } else {\r\n                    onError('HTTP Error', e);\r\n                }\r\n            });\r\n        }\r\n\r\n        var startErrorFunction = function (e) {\r\n            _client.connection.state = states.connection.bindingError;\r\n            if (_client.serviceHandlers.bindingError) {\r\n                _client.serviceHandlers.bindingError(e);\r\n            } else {\r\n                onError('HTTP start Error', e);\r\n            }\r\n        };\r\n\r\n        if (startUrlOptions.headers === undefined) {\r\n            startUrlOptions.headers = {};\r\n        }\r\n        if (_client.headers) {\r\n            for (var propName in _client.headers) {\r\n                startUrlOptions.headers[propName] = _client.headers[propName];\r\n            }\r\n        }\r\n\r\n        if (_client.proxy && _client.proxy.host && _client.proxy.port) {\r\n            startUrlOptions.path = startUrlOptions.protocol + '//' + startUrlOptions.host + startUrlOptions.path;\r\n            startUrlOptions.headers.host = startUrlOptions.host;\r\n            startUrlOptions.host = _client.proxy.host;\r\n            startUrlOptions.port = _client.proxy.port;\r\n        }\r\n\r\n        if (startUrlOptions.protocol === 'http:') {\r\n            var startResult = http.get(startUrlOptions, startFunction).on('error', startErrorFunction);\r\n        } else if (startUrlOptions.protocol === 'wss:') {\r\n            startUrlOptions.protocol = 'https:';\r\n            var startResult = https.get(startUrlOptions, startFunction).on('error', startErrorFunction);\r\n        } else {\r\n            onError('Protocol Error', undefined, startUrlOptions);\r\n        }\r\n\r\n\r\n    };\r\n\r\n    _client.start = function (tryOnceAgain) {\r\n        //connected: 3,\r\n        //retryingConnection: 8,\r\n        //connecting: 2,\r\n        if (_client.connection.state == states.connection.connected\r\n            || _client.connection.state == states.connection.retryingConnection\r\n            || _client.connection.state == states.connection.connecting) {\r\n            return true;\r\n        }\r\n        //unbound: 0,\r\n        //bindingError: 9,\r\n        else if (_client.connection.state == states.connection.bindingError\r\n            || _client.connection.state == states.connection.unbound) {\r\n            if (!tryOnceAgain) {\r\n                _client.getBinding();\r\n                setImmediate(_client.start, true);\r\n            }\r\n            return false;\r\n        }\r\n        //bound: 1,\r\n        //disconnecting: 4,\r\n        //disconnected: 5,\r\n        //connectFailed: 6,\r\n        //errorOccured: 7,\r\n        else if (_client.connection.state == states.connection.bound\r\n            || _client.connection.state == states.connection.disconnecting\r\n            || _client.connection.state == states.connection.disconnected\r\n            || _client.connection.state == states.connection.connectFailed\r\n            || _client.connection.state == states.connection.errorOccured) {\r\n            _client.connection.state = states.connection.connecting;\r\n\r\n            //connect to websockets\r\n            var connectQueryString = getConnectQueryString(_client);\r\n            _client.websocket.client.connect(connectQueryString, undefined, undefined, _client.headers);\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    _client.websocket.client.on('connectFailed', function (error) {\r\n        if (_client.connection.state == states.connection.retryingConnection\r\n            && scheduleReconnection(false)) {\r\n        } else {\r\n            _client.connection.state = states.connection.connectFailed;\r\n            if (_client.serviceHandlers.connectFailed) {\r\n                _client.serviceHandlers.connectFailed.apply(client, [error]);\r\n            } else {\r\n                console.log(\"Connect Failed!\");\r\n            }\r\n        }\r\n    });\r\n    _client.websocket.client.on('connect', function (connection) {\r\n        _client.websocket.connection = connection;\r\n        _client.websocket.messageid = 0; //Reset MessageID on new connection\r\n\r\n        //Note: check for reconnecting\r\n        if (_client.connection.state == states.connection.retryingConnection) {\r\n            //Note: reconnected event  \r\n            if (_client.serviceHandlers.reconnected) {\r\n                _client.serviceHandlers.reconnected.apply(client, [connection]);\r\n            } else {\r\n                console.log(\"Reconnected!\");\r\n            }\r\n        } else {\r\n            if (_client.serviceHandlers.connected) {\r\n                startCommunication(function (data) {\r\n\r\n                        _client.serviceHandlers.connected.apply(client, [connection]);\r\n                    },\r\n                    handlerErrors);\r\n            } else {\r\n                console.log(\"Connected!\");\r\n            }\r\n        }\r\n        connection.on('error', function (error) {\r\n            _client.websocket.connection = undefined;\r\n            _client.connection.state = states.connection.errorOccured;\r\n\r\n            //Note: Add support for automatic retry\r\n            if (error.code == \"ECONNRESET\") {\r\n                _client.connection.state = states.connection.retryingConnection;\r\n                if (_client.serviceHandlers.connectionLost) {\r\n                    _client.serviceHandlers.connectionLost.apply(client, [error]);\r\n                } else {\r\n                    console.log(\"Scheduled Reconnection: \" + error.toString());\r\n                }\r\n                scheduleReconnection(true);\r\n            } else {\r\n                if (_client.serviceHandlers.onerror) {\r\n                    _client.serviceHandlers.onerror.apply(client, [error]);\r\n                } else {\r\n                    console.log(\"Connection Error: \" + error.toString());\r\n                }\r\n            }\r\n        });\r\n        connection.on('close', function () {\r\n            if (_client.connection.state != states.connection.retryingConnection) {\r\n                _client.connection.state = states.connection.disconnected;\r\n            }\r\n            if (_client.serviceHandlers.disconnected) {\r\n                _client.serviceHandlers.disconnected.apply(client);\r\n            }\r\n            //Abort connection\r\n            abort();\r\n\r\n            _client.websocket.connection = undefined; //Release connection on close\r\n        });\r\n        connection.on('message', function (message) {\r\n            var handled = false;\r\n            if (_client.serviceHandlers.messageReceived) {\r\n                handled = _client.serviceHandlers.messageReceived.apply(client, [message]);\r\n            }\r\n            if (!handled) {\r\n                //{\"C\":\"d-8F1AB453-B,0|C,0|D,1|E,0\",\"S\":1,\"M\":[]}\r\n                if (message.type === 'utf8' && message.utf8Data != \"{}\") {\r\n                    var parsed = JSON.parse(message.utf8Data);\r\n\r\n                    //{\"C\":\"d-74C09D5E-B,1|C,0|D,1|E,0\",\"M\":[{\"H\":\"TestHub\",\"M\":\"addMessage\",\"A\":[\"ie\",\"sgds\"]}]}\r\n                    if (parsed.hasOwnProperty('M')) {\r\n                        for (var i = 0; i < parsed.M.length; i++) {\r\n                            var mesg = parsed.M[i];\r\n                            var hubName = mesg.H.toLowerCase();\r\n                            var handler = _client.handlers[hubName];\r\n                            if (handler) {\r\n                                var methodName = mesg.M.toLowerCase();\r\n                                var method = handler[methodName];\r\n                                if (method) {\r\n                                    var hub = client.hub(hubName)\r\n                                    method.apply(hub, mesg.A);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    else if (parsed.hasOwnProperty('I') && (parsed.hasOwnProperty('R') || parsed.hasOwnProperty('E'))) {\r\n                        handleCallResult(+parsed.I, parsed.E, parsed.R);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    _client.getBinding = function () {\r\n        getBindings(baseUrl, hubs, function (bindings) {\r\n\r\n            _client.hubData = bindings.hubs;\r\n\r\n            //hubs:  \r\n            for (var i = 0; i < bindings.hubs.length; i++) {\r\n                var hubData = bindings.hubs[i];\r\n                _client.hubs[hubData.name] = new hubInterface(_client, hubData);\r\n            }\r\n\r\n            //timeouts: { keepAlive: disconnect: connect: },\r\n            _client.timeouts.keepAlive = bindings.timeouts.keepAlive;\r\n            _client.timeouts.disconnect = bindings.timeouts.disconnect;\r\n            _client.timeouts.connect = bindings.timeouts.connect;\r\n\r\n            //connection: { token: id: },\r\n            _client.connection.state = states.connection.bound;\r\n            _client.connection.id = bindings.connection.id;\r\n            _client.connection.token = bindings.connection.token;\r\n\r\n            if (_client.serviceHandlers.bound) {\r\n                _client.serviceHandlers.bound.apply(client);\r\n            }\r\n\r\n            _client.start(true);\r\n        }, handlerErrors, _client);\r\n    };\r\n\r\n    if (doNotStart) {\r\n    }\r\n    else {\r\n        _client.getBinding();\r\n    }\r\n}\r\n\r\nfunction hubInterface(_client, hubData) {\r\n    var hub = this;\r\n    var _hub = {\r\n        pub: hub,\r\n        client: _client,\r\n        data: hubData\r\n    };\r\n\r\n    hub.__defineGetter__('name', function () { return _hub.data.name; });\r\n    hub.__defineGetter__('client', function () { return _hub.client.pub; });\r\n    hub.__defineGetter__('handlers', function () { return _hub.client.handlers[_hub.data.name]; });\r\n    hub.invoke = function (methodName) {\r\n        var args = getArgValues(arguments);\r\n        return _hub.client.invoke(_hub, methodName, args);\r\n    };\r\n    hub.on = function (methodName, callback) {\r\n        _hub.client.pub.on(_hub.data.name, methodName, callback);\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    client: clientInterface\r\n};"]}